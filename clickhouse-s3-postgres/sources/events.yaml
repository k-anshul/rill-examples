type: model
materialize: true
incremental: true

refresh:
  cron: "0 1 * * *"

partitions:
  glob: 
    path: "s3://bucket/path/y=*/m=*/d=*/*.parquet"
    partition: directory

sql: >
  SELECT
      '{{ .partition.path }}' as __partition,
      now() AS __load_time,
      *
  FROM s3(
      '{{ .partition.uri }}/*.parquet',
      '{{ .env.connector.s3.aws_access_key_id }}',
      '{{ .env.connector.s3.aws_secret_access_key }}'
  )

output:
  incremental_strategy: partition_overwrite
  partition_by: __partition
  engine: MergeTree
  order_by: (event_time)
